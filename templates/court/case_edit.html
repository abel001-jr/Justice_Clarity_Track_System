{% extends 'base.html' %}
{% load static %}

{% block title %}Edit Case - {{ case.case_number }} - Court Clerk{% endblock %}

{% block page_title %}Edit Case{% endblock %}

{% block sidebar_nav %}
<div class="nav-item">
    <a href="{% url 'core:clerk_dashboard' %}" class="nav-link">
        <i class="bi bi-speedometer2"></i>
        Dashboard
    </a>
</div>
<div class="nav-item">
    <a href="{% url 'court:case_list' %}" class="nav-link {% if 'case' in request.resolver_match.url_name %}active{% endif %}">
        <i class="bi bi-folder"></i>
        Cases
    </a>
</div>
<div class="nav-item">
    <a href="{% url 'court:hearing_list' %}" class="nav-link {% if 'hearing' in request.resolver_match.url_name %}active{% endif %}">
        <i class="bi bi-calendar"></i>
        Hearings
    </a>
</div>
<div class="nav-item">
    <a href="{% url 'court:report_list' %}" class="nav-link {% if 'report' in request.resolver_match.url_name %}active{% endif %}">
        <i class="bi bi-file-text"></i>
        Reports
    </a>
</div>
<div class="nav-item">
    <a href="{% url 'prison:inmate_list' %}" class="nav-link">
        <i class="bi bi-building"></i>
        Inmates
    </a>
</div>

<hr class="my-3">

<h6 class="sidebar-heading d-flex justify-content-between align-items-center px-3 mt-4 mb-1 text-muted">
    <span>Quick Actions</span>
</h6>
<div class="nav-item">
    <a href="{% url 'court:case_create' %}" class="nav-link">
        <i class="bi bi-plus-circle"></i>
        Create Case
    </a>
</div>
<div class="nav-item">
    <a href="{% url 'court:hearing_create' %}" class="nav-link">
        <i class="bi bi-calendar-plus"></i>
        Schedule Hearing
    </a>
</div>
<div class="nav-item">
    <a href="{% url 'court:report_create' %}" class="nav-link">
        <i class="bi bi-file-earmark-text"></i>
        Create Report
    </a>
</div>
{% endblock %}

{% block content %}
<div class="container-fluid">
    <div class="row">
        <!-- Main Content -->
        <main class="col-12">
            <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                <h1 class="h2">
                    <i class="bi bi-pencil me-2"></i>
                    Edit Case: {{ case.case_number }}
                </h1>
                <div class="btn-toolbar mb-2 mb-md-0">
                    <a href="{% url 'court:case_detail' case.id %}" class="btn btn-outline-secondary">
                        <i class="bi bi-arrow-left me-2"></i>
                        Back to Case
                    </a>
                </div>
            </div>

            <!-- Alert Messages -->
            {% if messages %}
                {% for message in messages %}
                    <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
                        {{ message }}
                        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                    </div>
                {% endfor %}
            {% endif %}

            <div class="row">
                <div class="col-lg-8">
                    <!-- Case Edit Form -->
                    <div class="card shadow-sm">
                        <div class="card-header">
                            <h5 class="card-title mb-0">
                                <i class="bi bi-clipboard-pen me-2"></i>
                                Edit Case Information
                            </h5>
                        </div>
                        <div class="card-body">
                            <form method="post">
                                {% csrf_token %}
                                
                                <div class="row">
                                    <div class="col-md-6 mb-3">
                                        <label for="case_number" class="form-label">Case Number *</label>
                                        <input type="text" class="form-control" id="case_number" name="case_number" 
                                               value="{{ case.case_number }}" required>
                                        <div class="form-text">Unique identifier for the case</div>
                                    </div>
                                    
                                    <div class="col-md-6 mb-3">
                                        <label for="case_type" class="form-label">Case Type *</label>
                                        <select class="form-select" id="case_type" name="case_type" required>
                                            <option value="">Select case type...</option>
                                            <option value="criminal" {% if case.case_type == 'criminal' %}selected{% endif %}>Criminal</option>
                                            <option value="civil" {% if case.case_type == 'civil' %}selected{% endif %}>Civil</option>
                                            <option value="family" {% if case.case_type == 'family' %}selected{% endif %}>Family</option>
                                            <option value="commercial" {% if case.case_type == 'commercial' %}selected{% endif %}>Commercial</option>
                                            <option value="administrative" {% if case.case_type == 'administrative' %}selected{% endif %}>Administrative</option>
                                        </select>
                                    </div>
                                </div>

                                <div class="mb-3">
                                    <label for="title" class="form-label">Case Title *</label>
                                    <input type="text" class="form-control" id="title" name="title" 
                                           value="{{ case.title }}" required>
                                </div>

                                <div class="row">
                                    <div class="col-md-6 mb-3">
                                        <label for="plaintiff" class="form-label">Plaintiff *</label>
                                        <input type="text" class="form-control" id="plaintiff" name="plaintiff" 
                                               value="{{ case.plaintiff }}" required>
                                    </div>
                                    
                                    <div class="col-md-6 mb-3">
                                        <label for="defendant" class="form-label">Defendant *</label>
                                        <input type="text" class="form-control" id="defendant" name="defendant" 
                                               value="{{ case.defendant }}" required>
                                    </div>
                                </div>

                                <div class="row">
                                    <div class="col-md-6 mb-3">
                                        <label for="plaintiff_lawyer" class="form-label">Plaintiff Lawyer</label>
                                        <input type="text" class="form-control" id="plaintiff_lawyer" name="plaintiff_lawyer" 
                                               value="{{ case.plaintiff_lawyer|default:'' }}">
                                    </div>
                                    
                                    <div class="col-md-6 mb-3">
                                        <label for="defendant_lawyer" class="form-label">Defendant Lawyer</label>
                                        <input type="text" class="form-control" id="defendant_lawyer" name="defendant_lawyer" 
                                               value="{{ case.defendant_lawyer|default:'' }}">
                                    </div>
                                </div>

                                <div class="mb-3">
                                    <label for="description" class="form-label">Case Description *</label>
                                    <textarea class="form-control" id="description" name="description" rows="4" required>{{ case.description }}</textarea>
                                </div>

                                <div class="row">
                                    <div class="col-md-6 mb-3">
                                        <label for="priority" class="form-label">Priority</label>
                                        <select class="form-select" id="priority" name="priority">
                                            <option value="low" {% if case.priority == 'low' %}selected{% endif %}>Low</option>
                                            <option value="medium" {% if case.priority == 'medium' %}selected{% endif %}>Medium</option>
                                            <option value="high" {% if case.priority == 'high' %}selected{% endif %}>High</option>
                                        </select>
                                    </div>
                                    
                                    <div class="col-md-6 mb-3">
                                        <label for="status" class="form-label">Status</label>
                                        <select class="form-select" id="status" name="status">
                                            <option value="pending" {% if case.status == 'pending' %}selected{% endif %}>Pending</option>
                                            <option value="assigned" {% if case.status == 'assigned' %}selected{% endif %}>Assigned</option>
                                            <option value="in_progress" {% if case.status == 'in_progress' %}selected{% endif %}>In Progress</option>
                                            <option value="decided" {% if case.status == 'decided' %}selected{% endif %}>Decided</option>
                                            <option value="closed" {% if case.status == 'closed' %}selected{% endif %}>Closed</option>
                                            <option value="appealed" {% if case.status == 'appealed' %}selected{% endif %}>Appealed</option>
                                        </select>
                                    </div>
                                </div>

                                <div class="d-grid gap-2 d-md-flex justify-content-md-end">
                                    <a href="{% url 'court:case_detail' case.id %}" class="btn btn-secondary">
                                        <i class="bi bi-x-circle me-2"></i>
                                        Cancel
                                    </a>
                                    <button type="submit" class="btn btn-primary">
                                        <i class="bi bi-check-circle me-2"></i>
                                        Update Case
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>

                <div class="col-lg-4">
                    <!-- Current Case Info -->
                    <div class="card shadow-sm">
                        <div class="card-header">
                            <h6 class="card-title mb-0">
                                <i class="bi bi-info-circle me-2"></i>
                                Current Case Info
                            </h6>
                        </div>
                        <div class="card-body">
                            <div class="mb-3">
                                <label class="form-label fw-bold">Case Number</label>
                                <p class="form-control-plaintext">{{ case.case_number }}</p>
                            </div>
                            <div class="mb-3">
                                <label class="form-label fw-bold">Filing Date</label>
                                <p class="form-control-plaintext">{{ case.filing_date|date:"M d, Y" }}</p>
                            </div>
                            <div class="mb-3">
                                <label class="form-label fw-bold">Created By</label>
                                <p class="form-control-plaintext">{{ case.created_by.get_full_name }}</p>
                            </div>
                            <div class="mb-3">
                                <label class="form-label fw-bold">Last Updated</label>
                                <p class="form-control-plaintext">{{ case.updated_at|date:"M d, Y" }}</p>
                            </div>
                        </div>
                    </div>

                    <!-- Quick Actions -->
                    <div class="card shadow-sm mt-3">
                        <div class="card-header">
                            <h6 class="card-title mb-0">
                                <i class="bi bi-lightning me-2"></i>
                                Quick Actions
                            </h6>
                        </div>
                        <div class="card-body">
                            <div class="d-grid gap-2">
                                <a href="{% url 'court:case_detail' case.id %}" class="btn btn-outline-primary btn-sm">
                                    <i class="bi bi-eye me-2"></i>
                                    View Case
                                </a>
                                <a href="{% url 'court:case_assign' case.id %}" class="btn btn-outline-info btn-sm">
                                    <i class="bi bi-person-plus me-2"></i>
                                    Assign Judge
                                </a>
                                <a href="{% url 'court:hearing_create' %}" class="btn btn-outline-success btn-sm">
                                    <i class="bi bi-calendar-plus me-2"></i>
                                    Schedule Hearing
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>
</div>
{% endblock %}

<!-- Prison Visitor Modal -->
<div class="modal fade" id="prisonVisitorModal" tabindex="-1" aria-labelledby="prisonVisitorModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header prison-modal">
                <h5 class="modal-title" id="prisonVisitorModalLabel">
                    <i class="bi bi-person-plus me-2"></i>
                    Visitor Management
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <!-- Visitor Log Form -->
                <form id="prisonVisitorForm">
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="inmateSelect" class="form-label">Inmate to Visit</label>
                                <select class="form-select" id="inmateSelect" required>
                                    <option value="">Select Inmate</option>
                                    <option value="INM001">INM001 - John Doe</option>
                                    <option value="INM002">INM002 - Jane Smith</option>
                                    <option value="INM003">INM003 - Mike Johnson</option>
                                </select>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="visitDate" class="form-label">Visit Date</label>
                                <input type="date" class="form-control" id="visitDate" required>
                            </div>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="visitorName" class="form-label">Visitor Name</label>
                                <input type="text" class="form-control" id="visitorName" placeholder="Full Name" required>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="visitorID" class="form-label">Visitor ID/Passport</label>
                                <input type="text" class="form-control" id="visitorID" placeholder="ID Number" required>
                            </div>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="relationship" class="form-label">Relationship to Inmate</label>
                                <select class="form-select" id="relationship" required>
                                    <option value="">Select Relationship</option>
                                    <option value="spouse">Spouse</option>
                                    <option value="parent">Parent</option>
                                    <option value="child">Child</option>
                                    <option value="sibling">Sibling</option>
                                    <option value="friend">Friend</option>
                                    <option value="lawyer">Lawyer</option>
                                    <option value="other">Other</option>
                                </select>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="visitType" class="form-label">Visit Type</label>
                                <select class="form-select" id="visitType" required>
                                    <option value="">Select Type</option>
                                    <option value="regular">Regular Visit</option>
                                    <option value="legal">Legal Visit</option>
                                    <option value="medical">Medical Visit</option>
                                    <option value="emergency">Emergency Visit</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="visitTime" class="form-label">Visit Time</label>
                                <input type="time" class="form-control" id="visitTime" required>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="duration" class="form-label">Duration (minutes)</label>
                                <select class="form-select" id="duration" required>
                                    <option value="">Select Duration</option>
                                    <option value="30">30 minutes</option>
                                    <option value="60">1 hour</option>
                                    <option value="90">1.5 hours</option>
                                    <option value="120">2 hours</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <div class="mb-3">
                        <label for="visitNotes" class="form-label">Visit Notes</label>
                        <textarea class="form-control" id="visitNotes" rows="3" placeholder="Any special notes or requirements for this visit"></textarea>
                    </div>

                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="officerName" class="form-label">Officer Name</label>
                                <input type="text" class="form-control" id="officerName" placeholder="Officer Name" required>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="badgeNumber" class="form-label">Badge Number</label>
                                <input type="text" class="form-control" id="badgeNumber" placeholder="Badge Number" required>
                            </div>
                        </div>
                    </div>
                </form>

                <hr>

                <!-- Today's Visits -->
                <div class="mt-4">
                    <h6 class="text-secondary mb-3">
                        <i class="bi bi-calendar-day me-2"></i>
                        Today's Scheduled Visits
                    </h6>
                    <div class="table-responsive">
                        <table class="table table-hover">
                            <thead class="table-light">
                                <tr>
                                    <th>Time</th>
                                    <th>Visitor</th>
                                    <th>Inmate</th>
                                    <th>Type</th>
                                    <th>Status</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>09:00</td>
                                    <td>Sarah Johnson</td>
                                    <td>INM001 - John Doe</td>
                                    <td><span class="badge bg-primary">Regular</span></td>
                                    <td><span class="badge bg-success">Completed</span></td>
                                    <td>
                                        <button class="btn btn-sm btn-outline-primary">View</button>
                                    </td>
                                </tr>
                                <tr>
                                    <td>11:30</td>
                                    <td>Attorney Smith</td>
                                    <td>INM002 - Jane Smith</td>
                                    <td><span class="badge bg-warning">Legal</span></td>
                                    <td><span class="badge bg-info">In Progress</span></td>
                                    <td>
                                        <button class="btn btn-sm btn-outline-primary">View</button>
                                    </td>
                                </tr>
                                <tr>
                                    <td>14:00</td>
                                    <td>Dr. Wilson</td>
                                    <td>INM003 - Mike Johnson</td>
                                    <td><span class="badge bg-danger">Medical</span></td>
                                    <td><span class="badge bg-secondary">Scheduled</span></td>
                                    <td>
                                        <button class="btn btn-sm btn-outline-primary">View</button>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Recent Visitors -->
                <div class="mt-4">
                    <h6 class="text-secondary mb-3">
                        <i class="bi bi-people me-2"></i>
                        Recent Visitors
                    </h6>
                    <div class="row">
                        <div class="col-md-6 mb-2">
                            <div class="d-flex align-items-center p-2 border rounded">
                                <div class="visitor-avatar me-3">
                                    <i class="bi bi-person-circle text-primary fs-4"></i>
                                </div>
                                <div class="flex-grow-1">
                                    <div class="fw-bold">Sarah Johnson</div>
                                    <small class="text-muted">Last visit: 2 hours ago</small>
                                </div>
                                <button class="btn btn-sm btn-outline-primary">Quick Log</button>
                            </div>
                        </div>
                        <div class="col-md-6 mb-2">
                            <div class="d-flex align-items-center p-2 border rounded">
                                <div class="visitor-avatar me-3">
                                    <i class="bi bi-person-circle text-success fs-4"></i>
                                </div>
                                <div class="flex-grow-1">
                                    <div class="fw-bold">Attorney Smith</div>
                                    <small class="text-muted">Last visit: 1 day ago</small>
                                </div>
                                <button class="btn btn-sm btn-outline-primary">Quick Log</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="submit" form="prisonVisitorForm" class="btn btn-prison-primary">
                    <i class="bi bi-person-plus me-2"></i>
                    Log Visit
                </button>
            </div>
        </div>
    </div>
</div>

<style>
.visitor-avatar {
    width: 40px;
    height: 40px;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 50%;
    background: #f8f9fa;
}

#prisonVisitorModal .table th {
    font-weight: 600;
    color: var(--prison-primary);
}

#prisonVisitorModal .badge {
    font-size: 0.75rem;
}

#prisonVisitorModal .form-control:focus,
#prisonVisitorModal .form-select:focus {
    border-color: var(--prison-primary);
    box-shadow: 0 0 0 3px rgba(220, 38, 38, 0.1);
}

#prisonVisitorModal .btn-outline-primary:hover {
    background-color: var(--prison-primary);
    border-color: var(--prison-primary);
}

#prisonVisitorModal .table-hover tbody tr:hover {
    background-color: rgba(220, 38, 38, 0.05);
}
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Set default date to today
    const today = new Date().toISOString().split('T')[0];
    document.getElementById('visitDate').value = today;
    
    // Set default time to current time
    const now = new Date();
    const currentTime = now.getHours().toString().padStart(2, '0') + ':' + now.getMinutes().toString().padStart(2, '0');
    document.getElementById('visitTime').value = currentTime;
    
    // Form submission
    const form = document.getElementById('prisonVisitorForm');
    if (form) {
        form.addEventListener('submit', function(e) {
            e.preventDefault();
            submitPrisonVisitorForm();
        });
    }
});

function submitPrisonVisitorForm() {
    // Get form data
    const formData = {
        inmate: document.getElementById('inmateSelect').value,
        visitDate: document.getElementById('visitDate').value,
        visitorName: document.getElementById('visitorName').value,
        visitorID: document.getElementById('visitorID').value,
        relationship: document.getElementById('relationship').value,
        visitType: document.getElementById('visitType').value,
        visitTime: document.getElementById('visitTime').value,
        duration: document.getElementById('duration').value,
        notes: document.getElementById('visitNotes').value,
        officerName: document.getElementById('officerName').value,
        badgeNumber: document.getElementById('badgeNumber').value
    };
    
    // Validate required fields
    const requiredFields = ['inmate', 'visitDate', 'visitorName', 'visitorID', 'relationship', 'visitType', 'visitTime', 'duration', 'officerName', 'badgeNumber'];
    const missingFields = requiredFields.filter(field => !formData[field]);
    
    if (missingFields.length > 0) {
        showAlert('Please fill in all required fields', 'warning');
        return;
    }
    
    // Simulate form submission
    showAlert('Processing visit log...', 'info');
    
    setTimeout(() => {
        // Simulate API call
        console.log('Submitting visitor form:', formData);
        
        // Show success message
        showAlert('Visit logged successfully!', 'success');
        
        // Close modal
        const modal = bootstrap.Modal.getInstance(document.getElementById('prisonVisitorModal'));
        modal.hide();
        
        // Reset form
        document.getElementById('prisonVisitorForm').reset();
        
        // Update today's visits table (in a real app, this would refresh from server)
        updatePrisonVisitsTable(formData);
        
    }, 1500);
}

function updatePrisonVisitsTable(newVisit) {
    // In a real application, this would update the table with new data from the server
    console.log('Updating visits table with:', newVisit);
    
    // For demo purposes, we'll just show a success message
    showAlert('Visit table updated successfully', 'success');
}

function quickLogVisitor(visitorName) {
    // Pre-fill form with visitor information
    document.getElementById('visitorName').value = visitorName;
    
    // Focus on the form
    document.getElementById('inmateSelect').focus();
    
    // Show alert
    showAlert(`Quick log initiated for ${visitorName}`, 'info');
}
</script>

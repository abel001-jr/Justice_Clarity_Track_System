<!-- Prison Program Modal -->
<div class="modal fade" id="prisonProgramModal" tabindex="-1" aria-labelledby="prisonProgramModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header prison-modal">
                <h5 class="modal-title" id="prisonProgramModalLabel">
                    <i class="bi bi-calendar-plus me-2"></i>
                    Program Management
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <!-- Program Creation Form -->
                <form id="prisonProgramForm">
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="programName" class="form-label">Program Name</label>
                                <input type="text" class="form-control" id="programName" placeholder="e.g., Anger Management, Vocational Training" required>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="programType" class="form-label">Program Type</label>
                                <select class="form-select" id="programType" required>
                                    <option value="">Select Type</option>
                                    <option value="rehabilitation">Rehabilitation</option>
                                    <option value="education">Education</option>
                                    <option value="vocational">Vocational Training</option>
                                    <option value="therapy">Therapy</option>
                                    <option value="recreation">Recreation</option>
                                    <option value="religious">Religious</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="startDate" class="form-label">Start Date</label>
                                <input type="date" class="form-control" id="startDate" required>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="endDate" class="form-label">End Date</label>
                                <input type="date" class="form-control" id="endDate" required>
                            </div>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="schedule" class="form-label">Schedule</label>
                                <select class="form-select" id="schedule" required>
                                    <option value="">Select Schedule</option>
                                    <option value="daily">Daily</option>
                                    <option value="weekly">Weekly</option>
                                    <option value="biweekly">Bi-weekly</option>
                                    <option value="monthly">Monthly</option>
                                </select>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="capacity" class="form-label">Maximum Capacity</label>
                                <input type="number" class="form-control" id="capacity" placeholder="Number of participants" min="1" required>
                            </div>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="instructor" class="form-label">Instructor/Facilitator</label>
                                <input type="text" class="form-control" id="instructor" placeholder="Instructor Name" required>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="location" class="form-label">Location</label>
                                <input type="text" class="form-control" id="location" placeholder="Room/Area" required>
                            </div>
                        </div>
                    </div>

                    <div class="mb-3">
                        <label for="programDescription" class="form-label">Program Description</label>
                        <textarea class="form-control" id="programDescription" rows="3" placeholder="Detailed description of the program, objectives, and expected outcomes" required></textarea>
                    </div>

                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="eligibility" class="form-label">Eligibility Criteria</label>
                                <textarea class="form-control" id="eligibility" rows="2" placeholder="Who can participate in this program"></textarea>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="requirements" class="form-label">Requirements</label>
                                <textarea class="form-control" id="requirements" rows="2" placeholder="Any special requirements or prerequisites"></textarea>
                            </div>
                        </div>
                    </div>
                </form>

                <hr>

                <!-- Active Programs -->
                <div class="mt-4">
                    <h6 class="text-secondary mb-3">
                        <i class="bi bi-calendar-check me-2"></i>
                        Active Programs
                    </h6>
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <div class="card program-card h-100">
                                <div class="card-body">
                                    <div class="d-flex align-items-start">
                                        <div class="program-icon me-3">
                                            <i class="bi bi-heart-pulse text-success fs-2"></i>
                                        </div>
                                        <div class="flex-grow-1">
                                            <h6 class="card-title">Anger Management</h6>
                                            <p class="card-text text-muted">Weekly sessions to help inmates manage anger and develop coping strategies.</p>
                                            <div class="program-stats">
                                                <span class="badge bg-success">15/20 enrolled</span>
                                                <span class="badge bg-primary">Rehabilitation</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="card-footer bg-transparent">
                                    <button class="btn btn-sm btn-outline-primary" onclick="viewProgramDetails('anger-management')">View Details</button>
                                    <button class="btn btn-sm btn-outline-success" onclick="manageParticipants('anger-management')">Manage Participants</button>
                                </div>
                            </div>
                        </div>

                        <div class="col-md-6 mb-3">
                            <div class="card program-card h-100">
                                <div class="card-body">
                                    <div class="d-flex align-items-start">
                                        <div class="program-icon me-3">
                                            <i class="bi bi-tools text-warning fs-2"></i>
                                        </div>
                                        <div class="flex-grow-1">
                                            <h6 class="card-title">Carpentry Workshop</h6>
                                            <p class="card-text text-muted">Vocational training in woodworking and furniture making.</p>
                                            <div class="program-stats">
                                                <span class="badge bg-warning">8/12 enrolled</span>
                                                <span class="badge bg-info">Vocational</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="card-footer bg-transparent">
                                    <button class="btn btn-sm btn-outline-primary" onclick="viewProgramDetails('carpentry')">View Details</button>
                                    <button class="btn btn-sm btn-outline-success" onclick="manageParticipants('carpentry')">Manage Participants</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Program Statistics -->
                <div class="mt-4">
                    <h6 class="text-secondary mb-3">
                        <i class="bi bi-graph-up me-2"></i>
                        Program Statistics
                    </h6>
                    <div class="row">
                        <div class="col-md-3 mb-3">
                            <div class="text-center p-3 border rounded">
                                <div class="fs-4 fw-bold text-primary">8</div>
                                <div class="text-muted">Active Programs</div>
                            </div>
                        </div>
                        <div class="col-md-3 mb-3">
                            <div class="text-center p-3 border rounded">
                                <div class="fs-4 fw-bold text-success">156</div>
                                <div class="text-muted">Total Participants</div>
                            </div>
                        </div>
                        <div class="col-md-3 mb-3">
                            <div class="text-center p-3 border rounded">
                                <div class="fs-4 fw-bold text-warning">23</div>
                                <div class="text-muted">Completed This Month</div>
                            </div>
                        </div>
                        <div class="col-md-3 mb-3">
                            <div class="text-center p-3 border rounded">
                                <div class="fs-4 fw-bold text-info">85%</div>
                                <div class="text-muted">Success Rate</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Upcoming Programs -->
                <div class="mt-4">
                    <h6 class="text-secondary mb-3">
                        <i class="bi bi-calendar-event me-2"></i>
                        Upcoming Programs
                    </h6>
                    <div class="table-responsive">
                        <table class="table table-hover">
                            <thead class="table-light">
                                <tr>
                                    <th>Program</th>
                                    <th>Start Date</th>
                                    <th>Type</th>
                                    <th>Enrolled</th>
                                    <th>Status</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>GED Preparation</td>
                                    <td>Next Week</td>
                                    <td><span class="badge bg-info">Education</span></td>
                                    <td>12/15</td>
                                    <td><span class="badge bg-success">Ready</span></td>
                                </tr>
                                <tr>
                                    <td>Substance Abuse Counseling</td>
                                    <td>In 2 weeks</td>
                                    <td><span class="badge bg-primary">Therapy</span></td>
                                    <td>8/10</td>
                                    <td><span class="badge bg-warning">Recruiting</span></td>
                                </tr>
                                <tr>
                                    <td>Computer Skills</td>
                                    <td>Next Month</td>
                                    <td><span class="badge bg-secondary">Vocational</span></td>
                                    <td>5/12</td>
                                    <td><span class="badge bg-info">Planning</span></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="submit" form="prisonProgramForm" class="btn btn-prison-primary">
                    <i class="bi bi-calendar-plus me-2"></i>
                    Create Program
                </button>
            </div>
        </div>
    </div>
</div>

<style>
.program-card {
    transition: all 0.3s ease;
    border: 1px solid #dee2e6;
}

.program-card:hover {
    transform: translateY(-4px);
    box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
    border-color: var(--prison-primary);
}

.program-icon {
    min-width: 50px;
    text-align: center;
}

.program-stats {
    margin-top: 0.5rem;
}

.program-stats .badge {
    margin-right: 0.25rem;
    margin-bottom: 0.25rem;
}

#prisonProgramModal .table th {
    font-weight: 600;
    color: var(--prison-primary);
}

#prisonProgramModal .badge {
    font-size: 0.75rem;
}

#prisonProgramModal .form-control:focus,
#prisonProgramModal .form-select:focus {
    border-color: var(--prison-primary);
    box-shadow: 0 0 0 3px rgba(220, 38, 38, 0.1);
}

#prisonProgramModal .btn-outline-primary:hover {
    background-color: var(--prison-primary);
    border-color: var(--prison-primary);
}

#prisonProgramModal .table-hover tbody tr:hover {
    background-color: rgba(220, 38, 38, 0.05);
}

#prisonProgramModal .border.rounded {
    transition: all 0.3s ease;
}

#prisonProgramModal .border.rounded:hover {
    border-color: var(--prison-primary) !important;
    box-shadow: 0 4px 15px rgba(220, 38, 38, 0.1);
}
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Set default start date to today
    const today = new Date().toISOString().split('T')[0];
    document.getElementById('startDate').value = today;
    
    // Set default end date to 3 months from today
    const threeMonthsFromNow = new Date();
    threeMonthsFromNow.setMonth(threeMonthsFromNow.getMonth() + 3);
    document.getElementById('endDate').value = threeMonthsFromNow.toISOString().split('T')[0];
    
    // Form submission
    const form = document.getElementById('prisonProgramForm');
    if (form) {
        form.addEventListener('submit', function(e) {
            e.preventDefault();
            submitPrisonProgramForm();
        });
    }
    
    // Date validation
    const startDate = document.getElementById('startDate');
    const endDate = document.getElementById('endDate');
    
    startDate.addEventListener('change', function() {
        if (endDate.value && startDate.value > endDate.value) {
            endDate.value = startDate.value;
        }
    });
    
    endDate.addEventListener('change', function() {
        if (startDate.value && endDate.value < startDate.value) {
            showAlert('End date cannot be before start date', 'warning');
            endDate.value = startDate.value;
        }
    });
});

function submitPrisonProgramForm() {
    // Get form data
    const formData = {
        programName: document.getElementById('programName').value,
        programType: document.getElementById('programType').value,
        startDate: document.getElementById('startDate').value,
        endDate: document.getElementById('endDate').value,
        schedule: document.getElementById('schedule').value,
        capacity: document.getElementById('capacity').value,
        instructor: document.getElementById('instructor').value,
        location: document.getElementById('location').value,
        description: document.getElementById('programDescription').value,
        eligibility: document.getElementById('eligibility').value,
        requirements: document.getElementById('requirements').value
    };
    
    // Validate required fields
    const requiredFields = ['programName', 'programType', 'startDate', 'endDate', 'schedule', 'capacity', 'instructor', 'location', 'description'];
    const missingFields = requiredFields.filter(field => !formData[field]);
    
    if (missingFields.length > 0) {
        showAlert('Please fill in all required fields', 'warning');
        return;
    }
    
    // Validate dates
    if (formData.startDate > formData.endDate) {
        showAlert('End date cannot be before start date', 'warning');
        return;
    }
    
    // Simulate form submission
    showAlert('Creating program...', 'info');
    
    setTimeout(() => {
        // Simulate API call
        console.log('Submitting program form:', formData);
        
        // Show success message
        showAlert('Program created successfully!', 'success');
        
        // Close modal
        const modal = bootstrap.Modal.getInstance(document.getElementById('prisonProgramModal'));
        modal.hide();
        
        // Reset form
        document.getElementById('prisonProgramForm').reset();
        
        // Update programs list (in a real app, this would refresh from server)
        updatePrisonProgramsList(formData);
        
    }, 1500);
}

function updatePrisonProgramsList(newProgram) {
    // In a real application, this would update the programs list with new data from the server
    console.log('Updating programs list with:', newProgram);
    
    // For demo purposes, we'll just show a success message
    showAlert('Programs list updated successfully', 'success');
}

function viewProgramDetails(programId) {
    // Show program details modal
    const programs = {
        'anger-management': {
            name: 'Anger Management',
            type: 'Rehabilitation',
            instructor: 'Dr. Sarah Wilson',
            schedule: 'Weekly (Tuesdays 2:00 PM)',
            location: 'Room 3A',
            description: 'A comprehensive program designed to help inmates understand and manage their anger through cognitive behavioral therapy techniques.',
            participants: 15,
            capacity: 20,
            startDate: '2024-01-15',
            endDate: '2024-04-15'
        },
        'carpentry': {
            name: 'Carpentry Workshop',
            type: 'Vocational Training',
            instructor: 'Mr. John Davis',
            schedule: 'Daily (9:00 AM - 12:00 PM)',
            location: 'Workshop B',
            description: 'Hands-on training in woodworking, furniture making, and basic carpentry skills for future employment.',
            participants: 8,
            capacity: 12,
            startDate: '2024-02-01',
            endDate: '2024-05-01'
        }
    };
    
    const program = programs[programId];
    if (program) {
        showPrisonProgramDetails(program);
    }
}

function showPrisonProgramDetails(program) {
    const modal = new bootstrap.Modal(document.getElementById('prisonProgramDetailsModal'));
    
    // Create details modal if it doesn't exist
    if (!document.getElementById('prisonProgramDetailsModal')) {
        const detailsModal = document.createElement('div');
        detailsModal.className = 'modal fade';
        detailsModal.id = 'prisonProgramDetailsModal';
        detailsModal.innerHTML = `
            <div class="modal-dialog modal-lg">
                <div class="modal-content">
                    <div class="modal-header prison-modal">
                        <h5 class="modal-title">Program Details</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                    </div>
                    <div class="modal-body" id="prisonProgramDetailsContent">
                        <!-- Content will be populated here -->
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                        <button type="button" class="btn btn-prison-primary" onclick="editProgram()">Edit Program</button>
                    </div>
                </div>
            </div>
        `;
        document.body.appendChild(detailsModal);
    }
    
    // Populate content
    const content = document.getElementById('prisonProgramDetailsContent');
    content.innerHTML = `
        <div class="row">
            <div class="col-md-8">
                <h5>${program.name}</h5>
                <p class="text-muted">${program.description}</p>
            </div>
            <div class="col-md-4">
                <div class="text-end">
                    <span class="badge bg-primary">${program.type}</span>
                </div>
            </div>
        </div>
        <hr>
        <div class="row">
            <div class="col-md-6">
                <p><strong>Instructor:</strong> ${program.instructor}</p>
                <p><strong>Schedule:</strong> ${program.schedule}</p>
                <p><strong>Location:</strong> ${program.location}</p>
            </div>
            <div class="col-md-6">
                <p><strong>Start Date:</strong> ${program.startDate}</p>
                <p><strong>End Date:</strong> ${program.endDate}</p>
                <p><strong>Enrollment:</strong> ${program.participants}/${program.capacity}</p>
            </div>
        </div>
    `;
    
    modal.show();
}

function manageParticipants(programId) {
    // Show participant management modal
    showAlert('Opening participant management for ' + programId, 'info');
    // In a real application, this would open a modal to manage program participants
}

function editProgram() {
    // Edit program functionality
    showAlert('Edit program functionality would be implemented here', 'info');
}
</script>
